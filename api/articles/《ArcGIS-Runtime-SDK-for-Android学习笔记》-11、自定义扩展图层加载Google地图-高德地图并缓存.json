{"title":"《ArcGIS Runtime SDK for Android学习笔记》-11、自定义扩展图层加载Google地图/高德地图并缓存","slug":"《ArcGIS-Runtime-SDK-for-Android学习笔记》-11、自定义扩展图层加载Google地图-高德地图并缓存","date":"2017-03-03T03:16:06.000Z","updated":"2018-05-03T16:52:37.554Z","comments":true,"path":"api/articles/《ArcGIS-Runtime-SDK-for-Android学习笔记》-11、自定义扩展图层加载Google地图-高德地图并缓存.json","excerpt":"本文主要介绍自定义扩展图层加载Google地图/高德地图并缓存<br>","covers":null,"content":"<p><strong>本文主要介绍自定义扩展图层加载Google地图/高德地图并缓存</strong><br><a id=\"more\"></a></p><h2 id=\"概述\"><a href=\"#概述\" class=\"headerlink\" title=\"概述\"></a>概述</h2><p>上篇文章介绍了自定义扩展图层加载天地图并缓存，由于众所周知的原因，天地图并不一定能满足所有项目需要，并不一定符合实际国情，所以这篇文章介绍自定义扩展图层加载Google地图/高德地图，因为 Google地图（<a href=\"http://ditu.google.cn\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">http://ditu.google.cn</a> ）/ 高德地图（<a href=\"http://ditu.amap.com\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">http://ditu.amap.com</a> ）的坐标系比较符合“中国特色坐标系“。<br>事实上加载Google地图/高德地图和加载天地图类似，甚至前者还要更简单。</p><h2 id=\"Google-Map\"><a href=\"#Google-Map\" class=\"headerlink\" title=\"Google Map\"></a>Google Map</h2><p>瓦片地址：</p><p><code>http://mt2.google.cn/vt/lyrs=m&amp;hl=zh-CN&amp;gl=cn&amp;x=420&amp;y=193&amp;z=9</code></p><p>核心代码如下：</p><pre><code class=\"java\">@Override\nprotected byte[] getTile(int level, int col, int row) throws Exception {\n\n    if (level &gt; layerInfo.getMaxZoomLevel() || level &lt; layerInfo.getMinZoomLevel()) {\n        return new byte[0];\n    }\n\n    byte[] bytes = null;\n    if (cachePath != null)\n        bytes = getOfflineCacheFile(cachePath, level, col, row);\n    if (bytes == null) {\n        String url = &quot;http://mt&quot; + (col % 4) + &quot;.google.cn/vt/lyrs=&quot;\n                + layerInfo.getLayerName() + &quot;&amp;hl=zh-CN&amp;gl=cn&amp;&quot;\n                + &quot;x=&quot; + col + &quot;&amp;&quot; + &quot;y=&quot; + row + &quot;&amp;&quot; + &quot;z=&quot; + level;\n\n        Log.d(&quot;GoogleMapLayer&quot;, &quot;getTile: &quot; + url);\n        Map&lt;String, String&gt; map = null;\n        bytes = com.esri.core.internal.io.handler.a.a(url, map);\n        if (cachePath != null)\n            AddOfflineCacheFile(cachePath, level, col, row, bytes);\n    }\n\n\n    return bytes;\n\n}\n</code></pre><p>其中</p><pre><code class=\"java\">String url = &quot;http://mt&quot; + (col % 4) + &quot;.google.cn/vt/lyrs=&quot;\n                    + layerInfo.getLayerName() + &quot;&amp;hl=zh-CN&amp;gl=cn&amp;&quot;\n                    + &quot;x=&quot; + col + &quot;&amp;&quot; + &quot;y=&quot; + row + &quot;&amp;&quot; + &quot;z=&quot; + level;\n</code></pre><p>可以更改为</p><pre><code class=\"java\">String url = &quot;https://mt&quot; + (col % 4) + &quot;.google.com/vt/lyrs=&quot;\n                    + layerInfo.getLayerName() + &quot;&amp;hl=zh-CN&amp;gl=cn&amp;&quot;\n                    + &quot;x=&quot; + col + &quot;&amp;&quot; + &quot;y=&quot; + row + &quot;&amp;&quot; + &quot;z=&quot; + level;\n</code></pre><p>但是这个URL不太符合目前的中国的国情。</p><h2 id=\"高德地图\"><a href=\"#高德地图\" class=\"headerlink\" title=\"高德地图\"></a>高德地图</h2><p>瓦片地址：</p><p><code>http://webst01.is.autonavi.com/appmaptile?style=6&amp;x=13417&amp;y=6499&amp;z=14</code></p><p>核心代码如下：</p><pre><code class=\"java\">@Override\nprotected byte[] getTile(int level, int col, int row) throws Exception {\n    if (level &gt; layerInfo.getMaxZoomLevel() || level &lt; layerInfo.getMinZoomLevel()) {\n        return new byte[0];\n    }\n\n    byte[] bytes = null;\n    if (cachePath != null)\n        bytes = getOfflineCacheFile(cachePath, level, col, row);\n    if (bytes == null) {\n\n        String url = &quot;http://webst0&quot; + ((col + row) % 4 + 1) + &quot;.is.autonavi.com/appmaptile?style=&quot;\n                + layerInfo.getLayerName()\n                + &quot;&amp;x=&quot; + col + &quot;&amp;y=&quot; + row + &quot;&amp;z=&quot; + level;\n        Map&lt;String, String&gt; map = null;\n        bytes = com.esri.core.internal.io.handler.a.a(url, map);\n        if (cachePath != null)\n            AddOfflineCacheFile(cachePath, level, col, row, bytes);\n    }\n\n\n    return bytes;\n}\n</code></pre><p>高德地图还可以获取路况信息：</p><pre><code class=\"java\">http://history.traffic.amap.com/traffic?type=2&amp;day=7&amp;hh=11&amp;mm=0&amp;x=13417&amp;y=6499&amp;z=14\n</code></pre><p>道理是一样的。</p><p><strong>按照惯例下面是我封装好的依赖。</strong></p><pre><code class=\"Java\">dependencies {\n    compile &#39;com.wshunli.map:arcgis-android-moremap:1.0.1&#39;\n}\n</code></pre><p>使用方法：</p><pre><code class=\"java\">MoreMapLayer（TYPE，PATH）；\n</code></pre><p>TYPE：有一下三种类型可选<br>PATH：缓存路径{选填}，为空则不缓存。</p><p>示例代码：</p><pre><code class=\"java\">MapView mMapView = (MapView) findViewById(R.id.map);\nString cachePath = Environment.getExternalStorageDirectory().getAbsoluteFile() + &quot;/MoreMapCache&quot;;\nMoreMapLayer vec_c = new MoreMapLayer(MoreMapLayerTypes.AMAP_VECTOR, cachePath);\nmMapView.addLayer(vec_c);\n\n</code></pre><p>更多信息：<a href=\"https://github.com/wshunli/arcgis-android-moremap\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">https://github.com/wshunli/arcgis-android-moremap</a></p><blockquote><p>参考资料<br>1、ArcGIS For Android 使用谷歌地图服务 - 牧羊的专栏 - 博客频道 - CSDN.NET<br><a href=\"http://blog.csdn.net/u014014578/article/details/21476395\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">http://blog.csdn.net/u014014578/article/details/21476395</a><br>2、客户端地图拼图算法解析 - 九毫 - 博客园<br><a href=\"http://www.cnblogs.com/ninemilli/archive/2011/12/26/2289285.html\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">http://www.cnblogs.com/ninemilli/archive/2011/12/26/2289285.html</a><br>3、OpenStreetMap/Google/百度/Bing瓦片地图服务(TMS) - 可可西 - 博客园<br><a href=\"http://www.cnblogs.com/kekec/p/3159970.html\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">http://www.cnblogs.com/kekec/p/3159970.html</a><br>4、国内主要地图瓦片坐标系定义及计算原理 | CntChen Blog<br><a href=\"http://cntchen.github.io/2016/05/09/国内主要地图瓦片坐标系定义及计算原理/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">http://cntchen.github.io/2016/05/09/国内主要地图瓦片坐标系定义及计算原理/</a><br>5、Arcgis for js加载百度地图 - LZUGIS - 博客频道 - CSDN.NET<br><a href=\"http://blog.csdn.net/gisshixisheng/article/details/44853709\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">http://blog.csdn.net/gisshixisheng/article/details/44853709</a><br>6、jxsapp/ArcGis_moka: arcgis Android 加载 Google 地图 相关工具包<br><a href=\"https://github.com/jxsapp/ArcGis_moka\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">https://github.com/jxsapp/ArcGis_moka</a><br>7、ArcGIS Javascript API 加载高德在线地图扩展 - ThinkGIS<br><a href=\"http://www.thinkgis.cn/topic/55bed4f76edd0d1a1d9f44cf\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">http://www.thinkgis.cn/topic/55bed4f76edd0d1a1d9f44cf</a></p></blockquote>","categories":[{"name":"移动GIS技术","path":"api/categories/移动GIS技术.json"}],"tags":[{"name":"Android","path":"api/tags/Android.json"},{"name":"ArcGIS","path":"api/tags/ArcGIS.json"},{"name":"ArcGIS Runtime SDK","path":"api/tags/ArcGIS Runtime SDK.json"},{"name":"ArcGIS for Android","path":"api/tags/ArcGIS for Android.json"}]}