{"title":"《ArcGIS Runtime SDK for Android学习笔记》-7、地图图层Layer","slug":"《ArcGIS-Runtime-SDK-for-Android学习笔记》-7、地图图层Layer","date":"2016-04-15T03:08:13.000Z","updated":"2018-04-10T14:49:55.442Z","comments":true,"path":"api/articles/《ArcGIS-Runtime-SDK-for-Android学习笔记》-7、地图图层Layer.json","excerpt":null,"covers":["https://img.wshunli.com/ArcGISforAndroid/7/地图图层Layer0.png-hexo.png"],"content":"<a id=\"more\"></a><p>在GIS中图层是很重要的概念，图层是空间数据的载体，通过它可将各种类型的地图数据进行加载显示，但图层只有添加到MapView对象中才能使用。在ArcGIS Runtime for Android中有许多种图层，不同图层有不同的作用，下图是图层的继承关系图：</p><p><img src=\"https://img.wshunli.com/ArcGISforAndroid/7/地图图层Layer0.png-hexo.png\" alt=\"\"></p><h1 id=\"DynamicLayer\"><a href=\"#DynamicLayer\" class=\"headerlink\" title=\"DynamicLayer\"></a>DynamicLayer</h1><p>DynamicLayer 是动态图层的基类.<br><img src=\"https://img.wshunli.com/ArcGISforAndroid/7/地图图层Layer2.png-hexo.png\" alt=\"\"></p><h2 id=\"ArcGISDynamicMapServiceLayer\"><a href=\"#ArcGISDynamicMapServiceLayer\" class=\"headerlink\" title=\"ArcGISDynamicMapServiceLayer\"></a>ArcGISDynamicMapServiceLayer</h2><p>ArcGISDynamicMapServiceLayer 图层对应 ArcGIS for Server 服务中的动态服务，动态地图服务的地图数据是按照移动设备范围读取的，用法与ArcGISTiledMapServiceLayer 图层相同。<br>ArcGISDynamicMapServiceLayer 图层通常包含多个图层，这些图层由server根据请求来渲染并以raster image形式返回，并且返回的raster并不包含feature的额外信息。它的功能特点是更新非常方便，并能及时呈现给用户，同时，图层的可视性和空间参考可以改变，可以给图层添加单独的layer definition，ArcGIS Server为每个image动态投影。而地图的空间参考是由第一个加载的图层决定。<br>它的性能特点：它的渲染时间取决于请求数据的数量和复杂度，因此一般都比tiled map server要慢，因此，它适合数据经常发生改变、或者需要针对不同的用户呈现不同的数据，且要素信息（如attributes，geometry，symbol等）不需要的情况。</p><pre><code class=\"java\"> //ArcGISDynamicMapServiceLayer class is used to define the Layer that is added to the\n //MapView object.\n MapView mv = new MapView(this);\n mv.addLayer(new ArcGISDynamicMapServiceLayer(\n &quot;http://sampleserver1.arcgisonline.com/ArcGIS/rest/services/Demographics/ESRI_Population_World/MapServer&quot;));\n setContentView(mv);\n</code></pre><h2 id=\"ArcGISImageServiceLayer\"><a href=\"#ArcGISImageServiceLayer\" class=\"headerlink\" title=\"ArcGISImageServiceLayer\"></a>ArcGISImageServiceLayer</h2><p>ArcGISImageServiceLayer图层对应ArcGIS for Server服务中的影像服务，调用影像服务也非常简单，同调用上述服务一样，示例代码如下：</p><pre><code class=\"java\"> //ArcGISImageServiceLayer class is used to define the Layer that is added to the\n //MapView object.\n MapView mv = new MapView(this);\n mv.addLayer(new ArcGISImageServiceLayer(\n &quot;http://myserver/arcgis/rest/services/MyImage/ImageServer&quot;,null));\n setContentView(mv);\n</code></pre><h2 id=\"WMSLayer\"><a href=\"#WMSLayer\" class=\"headerlink\" title=\"WMSLayer\"></a>WMSLayer</h2><p>加载符合开放地理空间联盟（OGC）标准的WMS服务器数据。<br>服务地址类似：</p><pre><code class=\"java\">http://[SERVER:PORT]/[INSTANCE]/services/[SERVICE]/MapServer/WMSServer\n</code></pre><p>添加示例代码如下：</p><pre><code class=\"java\">String wmsURL = &quot;http://[SERVER:PORT]/[INSTANCE]/services/[SERVICE]/MapServer/WMSServer&quot;;\n   WMSLayer wmsLayer = new WMSLayer(wmsURL);\n   mMapView.addLayer(wmsLayer);\n</code></pre><p>定义空间参考：</p><pre><code class=\"java\">// use a spatial reference defined by sr\n   WMSLayer wmsLayer = new WMSLayer(wmsURL, sr);\n   mMapView.addLayer(wmsLayer);\n</code></pre><p>利用图层名称组成的数列设置图层可见性：</p><pre><code class=\"java\">String[] visibleLayers = {&quot;ushigh&quot;, &quot;counties&quot;};\n   wmsLayer.setVisibleLayer(visibleLayers);\n</code></pre><p>获得所有图层信息：</p><pre><code class=\"java\">WMSLayerInfo[] wmsLayerInfo = wmsLayer.getLayers();\n</code></pre><h1 id=\"GraphicsLayer\"><a href=\"#GraphicsLayer\" class=\"headerlink\" title=\"GraphicsLayer\"></a>GraphicsLayer</h1><p>GraphicsLayer是ArcGIS Runtime for Android中比较重要的图层类型，也是使用最为频繁的一个。GraphicsLayer可以包含一个或多个Graphic对象，查询的返回结果和动态标绘的Graphic数据都要通过它呈现。建议在MapView中添加图层时不要第一个添加该类型的图层，因为MapView加载图层时先要初始化一些地图参数，而该图层不具备这些参数，其具体用法如下：</p><pre><code class=\"java\"> //GraphicsLayer class is used to define the Layer that is added to the\n //MapView object.\n MapView mv = new MapView(this);\n mv.addLayer(new GraphicsLayer());\n setContentView(mv);\n</code></pre><p>除了可以呈现Graphic对象外，它还具备了一些其他有用的功能，如要素更新与要素获取等等，由类GraphicsLayer处理，GraphicsLayer是由应用程序来定义的图层，专门用来绘制有空间参考的要素，并不适合绘制non-geographical要素，如指北针或copyright text。可以用屏幕坐标来查询图层中的要素并且使用getGraphics（）方法返回要素，并且支持设置图层比例尺。<br>不推荐在graphics layer中存放太多的要素，但是，它有着不错的性能，并且是feature layer class的基类，如果必须要处理大量的要素，建议使用feature collection来存储在feature layer中。</p><h1 id=\"TiledLayer\"><a href=\"#TiledLayer\" class=\"headerlink\" title=\"TiledLayer\"></a>TiledLayer</h1><p>TiledLayer为加载切片的图层。包含两个直接子类。<br>ArcGISLocalTiledLayer, TiledServiceLayer</p><h2 id=\"ArcGISLocalTiledLayer\"><a href=\"#ArcGISLocalTiledLayer\" class=\"headerlink\" title=\"ArcGISLocalTiledLayer\"></a>ArcGISLocalTiledLayer</h2><p>ArcGISLocalTiledLayer是用来添加离线数据包的图层，该图层目前支持两种格式的离线数据：一个是紧凑型的缓存切片，另一个是打包的tpk格式的数据，对于这两种数据的制作方法可以参照我的文章，图层用法如下：</p><pre><code class=\"java\">MapView mv = new MapView(this); \nArcGISLocalTiledLayer local = new ArcGISLocalTiledLayer(&quot;file:///mnt/sdcard/&lt;CacheName&gt;/Layers&quot;);//离线图层，将缓存的地址作为参数传入 \nmv.addLayer(local); \nsetContentView(mv);\n</code></pre><h2 id=\"TiledServiceLayer\"><a href=\"#TiledServiceLayer\" class=\"headerlink\" title=\"TiledServiceLayer\"></a>TiledServiceLayer</h2><p>ArcGISTiledMapServiceLayer, BingMapsLayer, OpenStreetMapLayer, WMTSLayer<br>1、ArcGISTiledMapServiceLayer<br>在ArcGIS for Server中可以发布多种地图服务，移动端需要有不同的图层来对应这些服务。ArcGISTiledMapServiceLayer图层对应ArcGIS for Server服务中的切片服务，于切片都是事先做好的，ArcGISTiledMapServiceLayer不能对图层中的数据进行更改，除非更新服务缓存，在arcgis for android中，也不允许对此类型的数据查询，通常用做底图使用。同时，因为加载的是缓存切片，这个类型的图层是arcgis for android中相应请求最快的图层之一，它采用多个线程，通常是每个图片使用一个线程来处理请求和绘制图片，并且异步处理。用法如下：</p><pre><code class=\"java\">MapView mv = new MapView(this); \nmv.addLayer(new ArcGISTiledMapServiceLayer( &quot;http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer&quot;)); \nsetContentView(mv);\n</code></pre><p>2、BingMapsLayer<br>BingMapsLayer用来加载必应地图。用法如下：</p><pre><code class=\"java\">MapView mv = new MapView(this);\nmv.addLayer(new BingMapsLayer(\n&quot;[your Bing Maps key]&quot;, MapStyle.Aerial));\nsetContentView(mv);\n</code></pre><p>3、OpenStreetMapLayer<br>OpenStreetMapLayer用来加载OpenStreetMapLayer。实际用得比较少。</p><p>4、WMTSLayer<br>WMTSLayer加载WMTS服务，比如加载天地图什么的。</p><h1 id=\"FeatureLayer\"><a href=\"#FeatureLayer\" class=\"headerlink\" title=\"FeatureLayer\"></a>FeatureLayer</h1><p>FeatureLayer是一种类型的层的特征组成; 在功能FeatureLayer包括几何图形和一组一致的属性。在一个特征FeatureLayer可以在地图，查询，编辑上显示，和选定（视觉突出显示）。每个要素都有一个唯一的ID。</p><p>一个FeatureLayer对应一个FeatureTable，这是在向传递FeatureLayer构造。在正确显示顺序，getSpatialReference（）值必须以该地图的空间参考匹配FeatureLayer 添加。如果功能层的 FeatureTable是GeodatabaseFeatureServiceTable，通过调用设置空间参考 setSpatialReference(SpatialReference) 方法。当FeatureTable是GeodatabaseFeatureTable从获得的地理数据库，生成使用地理数据库时所设置的空间参考GeodatabaseSyncTask通过调用 setOutSpatialRef（的SpatialReference）方法。</p><h1 id=\"KmlLayer\"><a href=\"#KmlLayer\" class=\"headerlink\" title=\"KmlLayer\"></a>KmlLayer</h1><p>KmlLayer是用来加载KML（Keyhole Markup Language）文件（.KML、.kmz）的图层。KML 是一种文件格式，用于在地球浏览器（例如 Google 地球、Google 地图和谷歌手机地图）中显示地理数据。KML 是由开放地理空间联盟（Open Geospatial Consortium, Inc.，简称 OGC）维护的国际标准。</p><h1 id=\"RasterLayer\"><a href=\"#RasterLayer\" class=\"headerlink\" title=\"RasterLayer\"></a>RasterLayer</h1><p>RasterLayer是用来加载影像的图层。ArcGIS Runtime SDK for Android 从10.2.4开始支持直接读取本地影像数据，数据类型包含：ASRP/USRP、CIB1,5,10、DTED0, 1, 2、GeoPackage、GeoTIFF、HFA、HRE、IMG、JPEG、JPEG2000、NITF、PNG、RPF、SRTM1, FileRasterSource是加载本地影像数据文件类，地图视图中以RasterLayer作为图层对象展示出来。代码如下：</p><pre><code class=\"java\">String rasterPath = Environment.getExternalStorageDirectory().getPath() + &quot;/raster/test.tif&quot;;\nFileRasterSource rasterSource;\ntry {  \n rasterSource = new FileRasterSource(rasterPath);  \n} catch (IllegalArgumentException ie) {\n  Log.d(TAG, &quot;null or empty path&quot;);\n} catch (FileNotFoundException fe) {\n  Log.d(TAG, &quot;raster file doesn&#39;t exist&quot;);\n} catch (RuntimeException re) {\n  Log.d(TAG, &quot;raster file can&#39;t be opened&quot;);\n}\nRasterLayer rasterLayer = new RasterLayer(rasterSource);\nmMapView.addLayer(rasterLayer);\n</code></pre><blockquote><p>参考资料<br>1、Layer | ArcGIS Android 10.2.7 API<br><a href=\"https://developers.arcgis.com/android/api-reference/reference/com/esri/android/map/Layer.html\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">https://developers.arcgis.com/android/api-reference/reference/com/esri/android/map/Layer.html</a></p></blockquote>","categories":[{"name":"移动GIS技术","path":"api/categories/移动GIS技术.json"}],"tags":[{"name":"Android","path":"api/tags/Android.json"},{"name":"ArcGIS","path":"api/tags/ArcGIS.json"},{"name":"ArcGIS Runtime SDK","path":"api/tags/ArcGIS Runtime SDK.json"},{"name":"ArcGIS for Android","path":"api/tags/ArcGIS for Android.json"}]}