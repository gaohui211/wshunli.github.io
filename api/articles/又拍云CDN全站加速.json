{"title":"又拍云CDN全站加速","slug":"又拍云CDN全站加速","date":"2017-11-11T11:44:24.000Z","updated":"2018-03-15T17:16:13.101Z","comments":true,"path":"api/articles/又拍云CDN全站加速.json","excerpt":"使用 Travis CI 自动部署 Hexo 博客，同时上传至又拍云。","covers":null,"content":"<p>使用 Travis CI 自动部署 Hexo 博客，同时上传至又拍云。</p><a id=\"more\"></a><p>前几天使用 Travis CI 自动构建 Hexo 博客并且上传至 Github 和 Coding，就在想能不能同时上传至 <a href=\"https://console.upyun.com/register/?invite=H1_D-bC4W\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">又拍云</a>。</p><p>今天晚上使用 ftp 上传至又拍云，网站实现全站 CDN 加速。</p><p>前面发现是有工具可以直接上传至又拍云：</p><p><a href=\"https://github.com/Menci/hexo-deployer-upyun\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">hexo-deployer-upyun</a></p><p>但是这个工具在 Windows 系统下使用有问题，并且我已经使用 Travis CI 自动部署了，继续使用这个工具有<strong>令牌</strong>暴露的风险。</p><p>所以就想使用 ftp 上传至又拍云，然后就发现了这个工具：</p><p><a href=\"https://github.com/git-ftp/git-ftp\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">Git-ftp</a> – uploads to FTP servers the Git way</p><p>在 linux 下的安装方法：</p><pre><code class=\"Shell\">git clone https://github.com/git-ftp/git-ftp.git\ncd git-ftp\n# choose the newest release\ntag=&quot;$(git tag | grep &#39;^[0-9]*\\.[0-9]*\\.[0-9]*$&#39; | tail -1)&quot;\n# checkout the latest tag\ngit checkout &quot;$tag&quot;\nsudo make install\n</code></pre><p>配置 git-ftp ：</p><pre><code class=\"Shell\">git config git-ftp.url &quot;ftp://ftp.example.net:21/public_html&quot;\ngit config git-ftp.user &quot;ftp-user&quot;\ngit config git-ftp.password &quot;secr3t&quot;\n</code></pre><p>第一次上传执行：</p><pre><code class=\"Shell\">git ftp init\n</code></pre><p>后面上传执行，只会上传变化的部分：</p><pre><code class=\"Shell\">git ftp push\n</code></pre><p>使用方法也很简单，下面就默认在原来 <a href=\"https://www.wshunli.com/posts/7dcaaf9e.html\">Travis CI 自动部署</a> 的基础上:</p><p>在 <code>.travis.yml</code> 文件中修改：</p><pre><code class=\"Shell\">install:\n  - npm install\n  - git clone https://github.com/git-ftp/git-ftp.git\n  - cd git-ftp\n  - tag=&quot;$(git tag | grep &#39;^[0-9]*\\.[0-9]*\\.[0-9]*$&#39; | tail -1)&quot;\n  - git checkout &quot;$tag&quot;\n  - sudo make install\n  - cd ..\n</code></pre><p>在 <code>publish-to-gh-pages.sh</code> 中修改</p><pre><code class=\"Shell\"># git-ftp 上传至 upyun\ngit config git-ftp.url &quot;ftp://v0.ftp.upyun.com:21/&quot;\ngit config git-ftp.user &quot;${UPYUN_USE}&quot;\ngit config git-ftp.password &quot;${UPYUN_PSD}&quot;\n\ngit ftp init\n# git ftp push\n</code></pre><p>第一次上传之后，修改 <code>publish-to-gh-pages.sh</code> 文件</p><pre><code class=\"Shell\"># git-ftp 上传至 upyun\ngit config git-ftp.url &quot;ftp://v0.ftp.upyun.com:21/&quot;\ngit config git-ftp.user &quot;${UPYUN_USE}&quot;\ngit config git-ftp.password &quot;${UPYUN_PSD}&quot;\n\n# git ftp init\ngit ftp push -v\n</code></pre><p>其中 UPYUN_USE 和 UPYUN_PSD 是在 Travis 中配置的 UPYUN ftp 用户名密码。<br>具体值可参考：<a href=\"https://docs.upyun.com/api/developer_tools/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">https://docs.upyun.com/api/developer_tools/</a></p><p>其实有点弊端就是上传之后更新具有一定的延迟性，但是速度快很多。</p><blockquote><p>参考资料<br>1、travis-ci-deploy-ftp<br><a href=\"https://github.com/ansediao/travis-ci-deploy-ftp\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">https://github.com/ansediao/travis-ci-deploy-ftp</a><br>2、How to use git-ftp： 使用 git-ftp 管理你的 FTP<br><a href=\"https://medium.com/@awonwon/how-to-use-git-ftp-使用-git-ftp-管理你的-ftp-1864700c6eb9\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">https://medium.com/@awonwon/how-to-use-git-ftp-使用-git-ftp-管理你的-ftp-1864700c6eb9</a><br>3、使用 git-ftp 将 git 两次提交发生变化的文件上传到服务器<br><a href=\"http://www.sunzhongwei.com/use-the-git-ftp-to-upload-git-diff-files-to-the-server\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">http://www.sunzhongwei.com/use-the-git-ftp-to-upload-git-diff-files-to-the-server</a></p></blockquote>","categories":[{"name":"博客维护","path":"api/categories/博客维护.json"}],"tags":[{"name":"Hexo","path":"api/tags/Hexo.json"},{"name":"Upyun","path":"api/tags/Upyun.json"}]}