{"title":"《ArcGIS Runtime SDK for Android学习笔记》-8、ArcGIS for Android 离线数据部署","slug":"《ArcGIS-Runtime-SDK-for-Android学习笔记》-8、ArcGIS-for-Android-离线数据部署","date":"2017-03-02T03:13:23.000Z","updated":"2018-04-09T14:49:10.046Z","comments":true,"path":"api/articles/《ArcGIS-Runtime-SDK-for-Android学习笔记》-8、ArcGIS-for-Android-离线数据部署.json","excerpt":"本文主要介绍在代码工程中添加数据并部署到移动终端的操作步骤<br>","covers":null,"content":"<p><strong>本文主要介绍在代码工程中添加数据并部署到移动终端的操作步骤</strong><br><a id=\"more\"></a></p><p>数据是GIS应用的基础，与所有GIS应用一样，用 ArcGIS for Android 开发的应用也离不开数据。而Android应用是在移动终端上运行的，数据和应用安装包都需要通过数据线连接进行拷贝，当终端较多时，尤其显得数据拷贝工作既繁琐又枯燥。为了更方便地部署应用数据，可以将数据文件放在工程资源中，在程序启动的同时，将数据一起部署到目标设备的指定目录。<br>本文介绍在代码工程中添加数据并部署到移动终端的操作步骤：<br>首先，数据文件拷贝到工程的assets目录；<br>然后，程序启动时，获取assets的内容并将其存储至移动端的指定目录。通过assets的方式，可以将数据一起打包到apk安装包中，安装完成后，程序启动时即可将数据部署至移动端，不需要再单独拷贝。</p><p>代码如下：</p><pre><code class=\"java\">/**\n * 将assets写入移动设备\n *\n * @param dir   assets下的文件夹\n */\npublic void copyAssetsDirToSdcard(String dir) {\n\n    String desFolder = ZZMANHOLE_PATH + dir;\n    FileUtils.createOrExistsDir(desFolder);\n\n    String[] mAssetsFileList = null;\n    try {\n        mAssetsFileList = getAssets().list(dir);\n    } catch (IOException e) {\n        e.printStackTrace();\n    }\n\n    assert mAssetsFileList != null;\n    for (String file : mAssetsFileList) {\n        File desFile = new File(desFolder + &quot;/&quot; + file);\n        if (!desFile.exists())\n            try {\n                InputStream is = getAssets().open(dir + &quot;/&quot; + file);\n                writeFileFromIS(desFile, is, false);\n\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n    }\n}\n</code></pre><p>说明：<br>1、<code>assets</code> 目录位置 <code>\\app\\src\\main\\assets</code>；<br>2、其中 <code>ZZMANHOLE_PATH</code> 为项目目录可通过以下代码获得：</p><pre><code class=\"java\">public static String PATH = android.os.Environment.getExternalStorageDirectory() + &quot;/pathname/&quot;;\n</code></pre><p>3、将 <code>assets</code> 目录下的 <code>path</code> 复制到 SDcard 项目目录：<br>copyAssetsDirToSdcard(“path”);<br>即将<code>\\app\\src\\main\\assets\\path</code> 复制到 <code>PATH\\path</code>；<br>4、<code>writeFileFromIS</code> 代码如下：</p><pre><code class=\"java\">/**\n * 将输入流写入文件\n *\n * @param file   文件\n * @param is     输入流\n * @param append 是否追加在文件末\n * @return {@code true}: 写入成功&lt;br&gt;{@code false}: 写入失败\n */\npublic static boolean writeFileFromIS(File file, InputStream is, boolean append) {\n    if (file == null || is == null) return false;\n    if (!createOrExistsFile(file)) return false;\n    OutputStream os = null;\n    try {\n        os = new BufferedOutputStream(new FileOutputStream(file, append));\n        byte data[] = new byte[1024];\n        int len;\n        while ((len = is.read(data, 0, 1024)) != -1) {\n            os.write(data, 0, len);\n        }\n        return true;\n    } catch (IOException e) {\n        e.printStackTrace();\n        return false;\n    } finally {\n        closeIO(is, os);\n    }\n}\n</code></pre><p>5、<code>closeIO</code> 代码如下：</p><pre><code class=\"java\">/**\n * 关闭IO\n * @param closeables closeable\n */\npublic static void closeIO(Closeable... closeables) {\n    if (closeables == null) return;\n    for (Closeable closeable : closeables) {\n        if (closeable != null) {\n            try {\n                closeable.close();\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n</code></pre><blockquote><p>参考资料<br>1、java - android 怎么复制assets文件夹到本地SD卡？ - SegmentFault <a href=\"https://segmentfault.com/q/1010000004478829\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">https://segmentfault.com/q/1010000004478829</a><br>2、Android学习之遍历拷贝assets下的目录 - linzhiyong的专栏 - 博客频道 - CSDN.NET <a href=\"http://blog.csdn.net/u012527802/article/details/52025849\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">http://blog.csdn.net/u012527802/article/details/52025849</a></p></blockquote>","categories":[{"name":"移动GIS技术","path":"api/categories/移动GIS技术.json"}],"tags":[{"name":"Android","path":"api/tags/Android.json"},{"name":"ArcGIS","path":"api/tags/ArcGIS.json"},{"name":"ArcGIS Runtime SDK","path":"api/tags/ArcGIS Runtime SDK.json"},{"name":"ArcGIS for Android","path":"api/tags/ArcGIS for Android.json"}]}