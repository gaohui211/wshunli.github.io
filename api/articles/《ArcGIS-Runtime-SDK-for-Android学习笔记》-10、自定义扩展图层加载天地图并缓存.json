{"title":"《ArcGIS Runtime SDK for Android学习笔记》-10、自定义扩展图层加载天地图并缓存","slug":"《ArcGIS-Runtime-SDK-for-Android学习笔记》-10、自定义扩展图层加载天地图并缓存","date":"2017-03-02T04:11:25.000Z","updated":"2018-04-12T14:50:56.707Z","comments":true,"path":"api/articles/《ArcGIS-Runtime-SDK-for-Android学习笔记》-10、自定义扩展图层加载天地图并缓存.json","excerpt":"本文主要介绍自定义扩展图层加载天地图并缓存","covers":null,"content":"<p><strong>本文主要介绍自定义扩展图层加载天地图并缓存</strong></p><a id=\"more\"></a><p>国家地理信息公共服务平台“ <a href=\"http://www.tianditu.com\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">天地图</a> ”（以下简称“天地图“）是国家测绘地理信息局主导建设的网络化地理信息共享与服务门户，集成了来自国家、省、市（县）各级测绘地理信息部门，以及相关政府部门、企事业单位 、社会团体、公众的地理信息公共服务资源，向各类用户提供权威、标准、统一的在线地理信息综合服务。<br>“天地图”属于基础性、公益性服务平台，针对不同用途设计了多种数据版本和服务模式，用户可根据自身需求进行使用。<br>基本情况如下：<br>1、基于 OGC 的 WMTS 1.0.0版本；<br>2、提供矢量地图、影像地图和地形图；<br>3、提供两种坐标系：国家2000大地坐标系和 Web Mercator 投影坐标系；<br>4、地图和标注数据分开，矢量地图和影像地图提供中英文标注，地形图仅提供中文标注。</p><p>核心代码如下：</p><pre><code class=\"java\">protected byte[] getTile(int level, int col, int row) throws Exception {\n        if (level &gt; layerInfo.getMaxZoomLevel()\n                || level &lt; layerInfo.getMinZoomLevel())\n            return new byte[0];\n        byte[] bytes = null;\n        if (cachePath != null)\n            bytes = getOfflineCacheFile(cachePath, level, col, row);\n        if (bytes == null) {\n            String url = layerInfo.getUrl()\n                    + &quot;?service=wmts&amp;request=gettile&amp;version=1.0.0&amp;layer=&quot;\n                    + layerInfo.getLayerName() + &quot;&amp;format=tiles&amp;tilematrixset=&quot;\n                    + layerInfo.getTileMatrixSet() + &quot;&amp;tilecol=&quot; + col\n                    + &quot;&amp;tilerow=&quot; + row + &quot;&amp;tilematrix=&quot; + (level + 1);\n            Map&lt;String, String&gt; map = null;\n            bytes = com.esri.core.internal.io.handler.a.a(url, map);\n            if (cachePath != null)\n                AddOfflineCacheFile(cachePath, level, col, row, bytes);\n        }\n        return bytes;\n    }\n</code></pre><p>我把整个项目封装成Jar包以供调用。下载地址：</p><pre><code class=\"Grovery\">repositories {\n    jcenter()\n}\n\ndependencies {\n    compile &#39;com.wshunli.map:arcgis-android-tianditu:1.1.0&#39;\n}\n</code></pre><p>更多信息：<a href=\"https://github.com/wshunli/arcgis-android-tianditu\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">https://github.com/wshunli/arcgis-android-tianditu</a></p><p>支持的天地图图层类型：</p><pre><code class=\"java\">package com.wshunli.map.tianditu;\n\n/**\n * 项目：TiDiTu\n * 作者：WangShunli\n * 时间：2016/4/9 11:33\n * 邮箱：admin@wshunli.com\n * 说明：\n */\npublic interface TianDiTuLayerTypes {\n\n    /**\n     * 天地图矢量墨卡托投影地图服务\n     */\n    final int TIANDITU_VECTOR_MERCATOR = 0;\n    /**\n     * 天地图矢量墨卡托中文标注\n     */\n    final int TIANDITU_VECTOR_ANNOTATION_CHINESE_MERCATOR = 1;\n    /**\n     * 天地图矢量墨卡托英文标注\n     */\n    final int TIANDITU_VECTOR_ANNOTATION_ENGLISH_MERCATOR = 2;\n    /**\n     * 天地图影像墨卡托投影地图服务\n     */\n    final int TIANDITU_IMAGE_MERCATOR = 3;\n    /**\n     * 天地图影像墨卡托投影中文标注\n     */\n    final int TIANDITU_IMAGE_ANNOTATION_CHINESE_MERCATOR = 4;\n    /**\n     * 天地图影像墨卡托投影英文标注\n     */\n    final int TIANDITU_IMAGE_ANNOTATION_ENGLISH_MERCATOR = 5;\n    /**\n     * 天地图地形墨卡托投影地图服务\n     */\n    final int TIANDITU_TERRAIN_MERCATOR = 6;\n    /**\n     * 天地图地形墨卡托投影中文标注\n     */\n    final int TIANDITU_TERRAIN_ANNOTATION_CHINESE_MERCATOR = 7;\n    /**\n     * 天地图矢量国家2000坐标系地图服务\n     */\n    final int TIANDITU_VECTOR_2000 = 8;\n    /**\n     * 天地图矢量国家2000坐标系中文标注\n     */\n    final int TIANDITU_VECTOR_ANNOTATION_CHINESE_2000 = 9;\n    /**\n     * 天地图矢量国家2000坐标系英文标注\n     */\n    final int TIANDITU_VECTOR_ANNOTATION_ENGLISH_2000 = 10;\n    /**\n     * 天地图影像国家2000坐标系地图服务\n     */\n    final int TIANDITU_IMAGE_2000 = 11;\n    /**\n     * 天地图影像国家2000坐标系中文标注\n     */\n    final int TIANDITU_IMAGE_ANNOTATION_CHINESE_2000 = 12;\n    /**\n     * 天地图影像国家2000坐标系英文标注\n     */\n    final int TIANDITU_IMAGE_ANNOTATION_ENGLISH_2000 = 13;\n    /**\n     * 天地图地形国家2000坐标系地图服务\n     */\n    final int TIANDITU_TERRAIN_2000 = 14;\n    /**\n     * 天地图地形国家2000坐标系中文标注\n     */\n    final int TIANDITU_TERRAIN_ANNOTATION_CHINESE_2000 = 15;\n}\n</code></pre><p>调用方法示例：</p><pre><code class=\"java\">package com.wshunli.map.tianditu.sample;\n\nimport android.os.Bundle;\nimport android.support.v7.app.AppCompatActivity;\nimport com.esri.android.map.MapView;\nimport com.esri.android.map.event.OnZoomListener;\nimport com.wshunli.map.tianditu.TianDiTuLayer;\nimport com.wshunli.map.tianditu.TianDiTuLayerTypes;\n\n/**\n * 项目：TiDiTuDemo\n * 作者：WangShunli\n * 时间：2017/3/2 12:38\n * 邮箱：admin@wshunli.com\n * 说明：\n */\npublic class MainActivity extends AppCompatActivity {\n    public static String TDT_PATH = android.os.Environment.getExternalStorageDirectory() + &quot;/TDTCacheDemo&quot;;\n    MapView mMapView;\n    //矢量地图\n    public TianDiTuLayer vec_c;\n    //矢量标注\n    public TianDiTuLayer cva_c;\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n\n        mMapView = (MapView) findViewById(R.id.map);\n        vec_c = new TianDiTuLayer(TianDiTuLayerTypes.TIANDITU_VECTOR_2000, TDT_PATH);\n        mMapView.addLayer(vec_c);\n        cva_c = new TianDiTuLayer(TianDiTuLayerTypes.TIANDITU_VECTOR_ANNOTATION_CHINESE_2000, TDT_PATH);\n        mMapView.addLayer(cva_c);\n        /**\n         * 解决天地图标注覆盖问题\n         */\n        mMapView.setOnZoomListener(new OnZoomListener() {\n            @Override\n            public void preAction(float v, float v1, double v2) {\n            }\n            @Override\n            public void postAction(float v, float v1, double v2) {\n                cva_c.clearTiles();\n            }\n        });\n    }\n}\n</code></pre><blockquote><p>参考资料<br>1、ArcGIS读取天地图2.0 - ArcGIS产品与技术专栏 - 博客频道 - CSDN.NET<br><a href=\"http://blog.csdn.net/arcgis_all/article/details/8848120\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">http://blog.csdn.net/arcgis_all/article/details/8848120</a><br>2、arcgis api for android 叠加天地图 - 阿华博台 - 博客频道 - CSDN.NET<br><a href=\"http://blog.csdn.net/yu624774720hua/article/details/8755398\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">http://blog.csdn.net/yu624774720hua/article/details/8755398</a><br>3、入门Android开发–ArcGis读取天地图，并实现一些简单功能。 - 从入门到忘记 - 博客频道 - CSDN.NET<br><a href=\"http://blog.csdn.net/u013867301/article/details/51036200\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">http://blog.csdn.net/u013867301/article/details/51036200</a><br>4、arcgis for android 本地缓存 | 大光的博客<br><a href=\"http://daguang.me/2013/08/01/arcgis-for-android-本地缓存/\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">http://daguang.me/2013/08/01/arcgis-for-android-本地缓存/</a><br>5、Android开发，arcgis自定义layer-历史影像和地图缓存的实现 - 博客频道 - CSDN.NET<br><a href=\"http://blog.csdn.net/Stanny_Bing/article/details/53736659\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">http://blog.csdn.net/Stanny_Bing/article/details/53736659</a></p></blockquote>","categories":[{"name":"移动GIS技术","path":"api/categories/移动GIS技术.json"}],"tags":[{"name":"Android","path":"api/tags/Android.json"},{"name":"ArcGIS","path":"api/tags/ArcGIS.json"},{"name":"ArcGIS Runtime SDK","path":"api/tags/ArcGIS Runtime SDK.json"},{"name":"ArcGIS for Android","path":"api/tags/ArcGIS for Android.json"}]}