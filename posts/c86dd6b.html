<!DOCTYPE html><html style="display:none" lang="zh"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><script>window.materialVersion="1.5.5",window.oldVersion=["codestartv1","1.3.4","1.4.0","1.4.0b1","1.5.0"]</script><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.wshunli.com/source"><link rel="dns-prefetch" href="https://cdn1.lncld.net"><link rel="dns-prefetch" href="https://hm.baidu.com"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="dns-prefetch" href="https://lib.baomitu.com"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="renderer" content="webkit"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>计算机基础-计算机网络（五） - CirGIS 博客</title><link rel="icon shortcut" type="image/ico" href="/favicon.ico"><link rel="icon" href="/favicon.ico"><meta name="format-detection" content="telephone=no"><meta name="description" itemprop="description" content="wshunli`s Blog!"><meta name="keywords" content="wshunli CirGIS,读书笔记,计算机基础,《计算机网络》"><meta name="theme-color" content="#606266"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]--><script>window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}},lsloader.removeLS=function(e){try{localStorage.removeItem(e)}catch(e){}},lsloader.setLS=function(e,t){try{localStorage.setItem(e,t)}catch(e){}},lsloader.getLS=function(e){var t="";try{t=localStorage.getItem(e)}catch(e){t=""}return t},versionString="/*"+(window.materialVersion||"unknownVersion")+"*/",lsloader.clean=function(){try{for(var e=[],t=0;t<localStorage.length;t++)e.push(localStorage.key(t));e.forEach(function(e){var n=lsloader.getLS(e);window.oldVersion&&window.oldVersion.reduce(function(e,t){return e||-1!==n.indexOf("/*"+t+"*/")},!1)&&lsloader.removeLS(e)})}catch(e){}},lsloader.clean(),lsloader.load=function(e,t,n,s){var a;if("boolean"==typeof n&&(s=n,n=void 0),s=s||!1,n=n||function(){},(a=this.getLS(e))&&-1===a.indexOf(versionString))return this.removeLS(e),void this.requestResource(e,t,n,s);if(a){if(a.split(versionString)[0]!=t)return console.log("reload:"+t),this.removeLS(e),void this.requestResource(e,t,n,s);a=a.split(versionString)[1],s?(this.jsRunSequence.push({name:e,code:a}),this.runjs(t,e,a)):(document.getElementById(e).appendChild(document.createTextNode(a)),n())}else this.requestResource(e,t,n,s)},lsloader.requestResource=function(t,n,e,s){var a=this;s?this.iojs(n,t,function(e,t,n){a.setLS(t,e+versionString+n),a.runjs(e,t,n)}):this.iocss(n,t,function(e){document.getElementById(t).appendChild(document.createTextNode(e)),a.setLS(t,n+versionString+e)},e)},lsloader.iojs=function(e,t,n){var s=this;s.jsRunSequence.push({name:t,code:""});try{var a=new XMLHttpRequest;a.open("get",e,!0),a.onreadystatechange=function(){if(4==a.readyState){if((200<=a.status&&a.status<300||304==a.status)&&""!=a.response)return void n(e,t,a.response);s.jsfallback(e,t)}},a.send(null)}catch(n){s.jsfallback(e,t)}},lsloader.iocss=function(e,t,n,s){var a=this;try{var o=new XMLHttpRequest;o.open("get",e,!0),o.onreadystatechange=function(){if(4==o.readyState){if((200<=o.status&&o.status<300||304==o.status)&&""!=o.response)return n(o.response),void s();a.cssfallback(e,t,s)}},o.send(null)}catch(n){a.cssfallback(e,t,s)}},lsloader.iofonts=function(e,t,n,s){var a=this;try{var o=new XMLHttpRequest;o.open("get",e,!0),o.onreadystatechange=function(){if(4==o.readyState){if((200<=o.status&&o.status<300||304==o.status)&&""!=o.response)return n(o.response),void s();a.cssfallback(e,t,s)}},o.send(null)}catch(n){a.cssfallback(e,t,s)}},lsloader.runjs=function(e,t,n){if(t&&n)for(var s in this.jsRunSequence)this.jsRunSequence[s].name==t&&(this.jsRunSequence[s].code=n);if(this.jsRunSequence[0]&&this.jsRunSequence[0].code&&"failed"!=this.jsRunSequence[0].status)(a=document.createElement("script")).appendChild(document.createTextNode(this.jsRunSequence[0].code)),a.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(a),this.jsRunSequence.shift(),0<this.jsRunSequence.length&&this.runjs();else if(this.jsRunSequence[0]&&"failed"==this.jsRunSequence[0].status){var a,o=this;(a=document.createElement("script")).src=this.jsRunSequence[0].path,a.type="text/javascript",this.jsRunSequence[0].status="loading",a.onload=function(){o.jsRunSequence.shift(),0<o.jsRunSequence.length&&o.runjs()},document.body.appendChild(a)}},lsloader.tagLoad=function(e,t){this.jsRunSequence.push({name:t,code:"",path:e,status:"failed"}),this.runjs()},lsloader.jsfallback=function(e,t){if(!this.jsnamemap[t]){for(var n in this.jsnamemap[t]=t,this.jsRunSequence)this.jsRunSequence[n].name==t&&(this.jsRunSequence[n].code="",this.jsRunSequence[n].status="failed",this.jsRunSequence[n].path=e);this.runjs()}},lsloader.cssfallback=function(e,t,n){if(!this.cssnamemap[t]){this.cssnamemap[t]=1;var s=document.createElement("link");s.type="text/css",s.href=e,s.rel="stylesheet",s.onload=s.onerror=n;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(s,a)}},lsloader.runInlineScript=function(e,t){var n=document.getElementById(t).innerText;this.jsRunSequence.push({name:e,code:n}),this.runjs()}</script><script>function Queue(){this.dataStore=[],this.offer=function(e){this.debug&&console.log("Offered a Queued Function."),"function"==typeof e?this.dataStore.push(e):console.log("You must offer a function.")},this.poll=function(){return this.debug&&console.log("Polled a Queued Function."),this.dataStore.shift()},this.execNext=function(){var e=this.poll();void 0!==e&&(this.debug&&console.log("Run a Queued Function."),e())},this.debug=!1,this.startDebug=function(){this.debug=!0}}var queue=new Queue</script><style id="material_css"></style><script>void 0===window.lsLoadCSSMaxNums&&(window.lsLoadCSSMaxNums=0),window.lsLoadCSSMaxNums++,lsloader.load("material_css","https://cdn.wshunli.com/source/css/material.min.css",function(){void 0===window.lsLoadCSSNums&&(window.lsLoadCSSNums=0),window.lsLoadCSSNums++,window.lsLoadCSSNums==window.lsLoadCSSMaxNums&&(document.documentElement.style.display="")},!1)</script><style id="style_css"></style><script>void 0===window.lsLoadCSSMaxNums&&(window.lsLoadCSSMaxNums=0),window.lsLoadCSSMaxNums++,lsloader.load("style_css","https://cdn.wshunli.com/source/css/style.min.css",function(){void 0===window.lsLoadCSSNums&&(window.lsLoadCSSNums=0),window.lsLoadCSSNums++,window.lsLoadCSSNums==window.lsLoadCSSMaxNums&&(document.documentElement.style.display="")},!1)</script><style id="prettify_css"></style><script>void 0===window.lsLoadCSSMaxNums&&(window.lsLoadCSSMaxNums=0),window.lsLoadCSSMaxNums++,lsloader.load("prettify_css","https://cdn.wshunli.com/source/css/prettify.min.css",function(){void 0===window.lsLoadCSSNums&&(window.lsLoadCSSNums=0),window.lsLoadCSSNums++,window.lsLoadCSSNums==window.lsLoadCSSMaxNums&&(document.documentElement.style.display="")},!1)</script><style id="prettify_theme"></style><script>void 0===window.lsLoadCSSMaxNums&&(window.lsLoadCSSMaxNums=0),window.lsLoadCSSMaxNums++,lsloader.load("prettify_theme","https://cdn.wshunli.com/source/css/prettify/github-v2.min.css",function(){void 0===window.lsLoadCSSNums&&(window.lsLoadCSSNums=0),window.lsLoadCSSNums++,window.lsLoadCSSNums==window.lsLoadCSSMaxNums&&(document.documentElement.style.display="")},!1)</script><style>body,html{font-family:Roboto,"Helvetica Neue",Helvetica,"PingFang SC","Hiragino Sans GB","Microsoft YaHei","微软雅黑",Arial,sans-serif;overflow-x:hidden!important}code{font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace}a{color:#409eff}#scheme-Paradox .hot_tags-count,#scheme-Paradox .sidebar-colored .sidebar-badge,#scheme-Paradox .sidebar-colored .sidebar-header,#scheme-Paradox .sidebar_archives-count,#search-form-label:after,#search-label,.mdl-card__media{background-color:#757575!important}#scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus,#scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover{color:#757575!important}#ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a,#post_entry-right-info,.sidebar-colored .sidebar-nav li:hover>a,.sidebar-colored .sidebar-nav li:hover>a i,.sidebar-colored .sidebar-nav li>a:focus i,.sidebar-colored .sidebar-nav li>a:hover,.sidebar-colored .sidebar-nav li>a:hover i,.sidebar-colored .sidebar-nav>.open>a,.sidebar-colored .sidebar-nav>.open>a:focus,.sidebar-colored .sidebar-nav>.open>a:hover{color:#757575!important}.toTop{background:#757575!important}.material-layout .material-index>.material-nav,.material-layout .material-post>.material-nav,.material-nav a{color:#757575}#scheme-Paradox .MD-burger-layer{background-color:#757575}#scheme-Paradox #post-toc-trigger-btn{color:#757575}.post-toc a:hover{color:#409eff;text-decoration:underline}#post-content h1{font-size:1.75em;border-bottom:1px solid #ddd}#post-content h2{font-size:1.5em;border-bottom:1px solid #eee}#post-content h3{font-size:1.25em}#post-content h4{font-size:1em}#post-content h5{font-size:1em}#post-content h6{color:#777;font-size:1em}a{text-decoration:none;font-weight:500}#post-content a{text-decoration:none;font-weight:400}#post-content a:hover{text-decoration:underline}.mdl-card__media{background-color:#fff!important}.disqus_click_btn{margin:0 auto!important}#comment .veditor{font-size:1em;font-family:Roboto,"Helvetica Neue",Helvetica,"PingFang SC","Hiragino Sans GB","Microsoft YaHei","微软雅黑",Arial,sans-serif}#post-content table{width:100%;overflow:auto;display:table;border-spacing:0;border-collapse:collapse}</style><style>body{background-color:#f5f5f5}#scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{background-color:#fff}</style><style>.fade{transition:all .8s linear;-webkit-transform:translate3d(0,0,0);-moz-transform:translate3d(0,0,0);-ms-transform:translate3d(0,0,0);-o-transform:translate3d(0,0,0);transform:translate3d(0,0,0);opacity:1}.fade.out{opacity:0}</style><style>@font-face{font-family:Roboto;font-style:normal;font-weight:300;src:url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-300.eot);src:local('Roboto'),local('Roboto-Normal'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-300.eot?#iefix) format('embedded-opentype'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-300.woff2) format('woff2'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-300.woff) format('woff'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-300.ttf) format('truetype'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-300.svg#Roboto) format('svg')}@font-face{font-family:Roboto;font-style:normal;font-weight:regular;src:url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-regular.eot);src:local('Roboto'),local('Roboto-Normal'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-regular.eot?#iefix) format('embedded-opentype'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-regular.woff2) format('woff2'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-regular.woff) format('woff'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-regular.ttf) format('truetype'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-regular.svg#Roboto) format('svg')}@font-face{font-family:Roboto;font-style:normal;font-weight:500;src:url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-500.eot);src:local('Roboto'),local('Roboto-Normal'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-500.eot?#iefix) format('embedded-opentype'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-500.woff2) format('woff2'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-500.woff) format('woff'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-500.ttf) format('truetype'),url(https://lib.baomitu.com/fonts/roboto/roboto-v15-latin-500.svg#Roboto) format('svg')}</style><style id="material_icons"></style><script>void 0===window.lsLoadCSSMaxNums&&(window.lsLoadCSSMaxNums=0),window.lsLoadCSSMaxNums++,lsloader.load("material_icons","https://cdn.wshunli.com/source/css/material-icons.css",function(){void 0===window.lsLoadCSSNums&&(window.lsLoadCSSNums=0),window.lsLoadCSSNums++,window.lsLoadCSSNums==window.lsLoadCSSMaxNums&&(document.documentElement.style.display="")},!1)</script><script>lsloader.load("jq_js","https://cdn.wshunli.com/source/js/jquery.min.js",!0)</script><meta name="mobile-web-app-capable" content="yes"><meta name="application-name" content="CirGIS 博客"><meta name="msapplication-starturl" content="https://www.wshunli.com/posts/c86dd6b.html"><meta name="msapplication-navbutton-color" content="#606266"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="CirGIS 博客"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="apple-touch-icon" href="/favicon.ico"><meta name="google-site-verification" content="JXtW4RzgvIKoQlyN4B8PC-gd2hm7yaZo7NnrGDZHFsM"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><meta property="og:url" content="https://www.wshunli.com/posts/c86dd6b.html"><meta property="og:type" content="blog"><meta property="og:title" content="计算机基础-计算机网络（五） | CirGIS 博客"><meta property="og:image" content="/favicon.ico"><meta property="og:description" content="wshunli`s Blog!"><meta property="og:article:tag" content="读书笔记"><meta property="og:article:tag" content="计算机基础"><meta property="og:article:tag" content="《计算机网络》"><meta property="article:published_time" content="Sat Oct 07 2017 09:20:20 GMT+0800"><meta property="article:modified_time" content="Fri Jul 05 2019 02:13:53 GMT+0800"><meta name="twitter:card" content="summary_large_image"><link rel="canonical" href="https://www.wshunli.com/posts/c86dd6b.html"><script type="application/ld+json">{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "https://www.wshunli.com/posts/c86dd6b.html",
    "headline": "计算机基础-计算机网络（五）",
    "datePublished": "Sat Oct 07 2017 09:20:20 GMT+0800",
    "dateModified": "Fri Jul 05 2019 02:13:53 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "wshunli",
        "image": {
            "@type": "ImageObject",
            "url": "/img/wshunli.min.png"
        },
        "description": "深自缄默，如云漂泊"
    },
    "publisher": {
        "@type": "Organization",
        "name": "CirGIS 博客",
        "logo": {
            "@type":"ImageObject",
            "url": "/favicon.ico"
        }
    },
    "keywords": ",读书笔记,计算机基础,《计算机网络》wshunli CirGIS",
    "description": "wshunli`s Blog!",
}</script><script>!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject="ga",e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script"),ga("create","UA-72210097-1","auto"),ga("send","pageview")</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?a5dd3121a832e079930d6bf385c5e806";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></head><body id="scheme-Paradox" class="lazy"><div class="material-layout mdl-js-layout has-drawer is-upgraded"><main class="material-layout__content" id="main"><div id="top"></div><button class="MD-burger-icon sidebar-toggle"><span id="MD-burger-id" class="MD-burger-layer"></span></button> <button id="post-toc-trigger-btn" class="mdl-button mdl-js-button mdl-button--icon"><i class="material-icons">format_list_numbered</i></button><ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh;overflow-y:scroll"><ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#运输层协议概述"><span class="post-toc-number">1.</span> <span class="post-toc-text">运输层协议概述</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#用户数据报协议-UDP"><span class="post-toc-number">2.</span> <span class="post-toc-text">用户数据报协议 UDP</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#传输控制协议-TCP"><span class="post-toc-number">3.</span> <span class="post-toc-text">传输控制协议 TCP</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#可靠传输的工作原理"><span class="post-toc-number">4.</span> <span class="post-toc-text">可靠传输的工作原理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#停止等地协议-ARQ"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">停止等地协议 ARQ</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#连续-ARQ-协议"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">连续 ARQ 协议</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#TCP-报文段"><span class="post-toc-number">5.</span> <span class="post-toc-text">TCP 报文段</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#TCP-可靠传输的实现"><span class="post-toc-number">6.</span> <span class="post-toc-text">TCP 可靠传输的实现</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#超时重传时间的选择"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">超时重传时间的选择</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#选择确认-SACK"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">选择确认 SACK</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#TCP-的流量控制"><span class="post-toc-number">7.</span> <span class="post-toc-text">TCP 的流量控制</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#TCP-的拥塞控制"><span class="post-toc-number">8.</span> <span class="post-toc-text">TCP 的拥塞控制</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#拥塞控制设计"><span class="post-toc-number">8.1.</span> <span class="post-toc-text">拥塞控制设计</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#拥塞控制的方法"><span class="post-toc-number">8.2.</span> <span class="post-toc-text">拥塞控制的方法</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#TCP拥塞控制和流量控制的差别"><span class="post-toc-number">8.3.</span> <span class="post-toc-text">TCP拥塞控制和流量控制的差别</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#TCP-的运输连接管理"><span class="post-toc-number">9.</span> <span class="post-toc-text">TCP 的运输连接管理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#TCP-的连接建立"><span class="post-toc-number">9.1.</span> <span class="post-toc-text">TCP 的连接建立</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#TCP-的连接释放"><span class="post-toc-number">9.2.</span> <span class="post-toc-text">TCP 的连接释放</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#TCP-的有限状态机"><span class="post-toc-number">9.3.</span> <span class="post-toc-text">TCP 的有限状态机</span></a></li></ol></li></ol></ul><div class="material-post_container"><div class="material-post mdl-grid"><div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col"><div class="post_thumbnail-custom mdl-card__media mdl-color-text--grey-50" style="background-image:url(https://img.wshunli.com/计算机基础-计算机网络/internet.min.png)"><p class="article-headline-p">计算机基础-计算机网络（五）</p></div><div class="mdl-color-text--grey-700 mdl-card__supporting-text meta"><div id="author-avatar"><img src="/img/wshunli.min.png" width="44px" height="44px" alt="Author Avatar"></div><div><strong>wshunli</strong> <span>10月 07, 2017</span></div><div class="section-spacer"></div><button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"><i class="material-icons" role="presentation">devices other</i> <span class="visuallyhidden">devices other</span></button><ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button"><li class="mdl-menu__item">在其它设备中阅读本文章</li><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAAB6ElEQVR42u3aQVLDMAwF0Nz/0nAApuF/OS0kfl4xndbxy0LIko6vR6wDAwMDAwMDA+PfMI54/fzV+SfJ/ktnwMDA2IzxS2grD53snH/z5RkwMDC2ZJwHxPw7yStY3x8DAwPj/DFJ6JwlmhgYGBjXMtqwe21Ax8DA2JMxu3AOD/G3d3EMDIwbMvKi/Pv+/mh/AwMD41aMesShvNzmTYWPzoxgYGDcijErkOWBMm9n5s/FwMDYkzErmZ1/3rYwk1eGgYGxJ2NlAKIukF2UFGJgYOzGaNO45BW0gbUd78DAwNiZkT8gOXp7rOTVYGBg7Mxoj9I2DNoB1uFdHAMD49GMdiw1bxi0RbcL/m9gYGA8lDFL2maDp+2exSUWAwPjoYyVgldyoLZFOgy4GBgYj2a0ydlKMpdQiwFZDAyMLRmzAlkevvPSXvQUDAyMLRnr6WCR2JVUDAwMjDbtWx/5ylPDlzwMDIxtGO1Kmpf5PrOCHQYGxm6MI175RTf/7Xlwv2AOFwMD40GMPDjOLrr5EfMRNAwMjD0ZbSsxGVFt2w+X3cUxMDC2Z+RtgDawFm1UDAwMjDKwzlbbKsDAwMBYKeInpbQ24A6HLTAwMB7KmAXHlStr3rx8S38DAwPjVoz7LgwMDAwMDAyMP13fy88w3Yi5OuEAAAAASUVORK5CYII="></ul><button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"><i class="material-icons" role="presentation">bookmark</i> <span class="visuallyhidden">bookmark</span></button><ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button"><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/《计算机网络》/">《计算机网络》</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/计算机基础/">计算机基础</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/读书笔记/">读书笔记</a></li></ul><button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"><i class="material-icons" role="presentation">share</i> <span class="visuallyhidden">share</span></button><ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button"><a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=计算机基础-计算机网络（五）&url=https://www.wshunli.com/posts/c86dd6b.html&pic=https://www.wshunli.com/favicon.ico&searchPic=false&style=simple" target="_blank" rel="external nofollow noopener noreferrer"><li class="mdl-menu__item">分享到微博</li></a><a class="post_share-link" href="https://twitter.com/intent/tweet?text=计算机基础-计算机网络（五）&url=https://www.wshunli.com/posts/c86dd6b.html&via=wshunli" target="_blank" rel="external nofollow noopener noreferrer"><li class="mdl-menu__item">分享到 Twitter</li></a><a class="post_share-link" href="https://telegram.me/share/url?url=https://www.wshunli.com/posts/c86dd6b.html&text=计算机基础-计算机网络（五）" target="_blank" rel="external nofollow noopener noreferrer"><li class="mdl-menu__item">分享到 Telegram</li></a></ul></div><div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out"><p><strong>计算机网络-运输层</strong> 部分读书笔记</p><h1 id="运输层协议概述"><a href="#运输层协议概述" class="headerlink" title="运输层协议概述"></a>运输层协议概述</h1><p>运输层提供应用进程间的逻辑通信。</p><p><img src="https://img.wshunli.com/计算机基础-计算机网络/5/运输层-运输层和网络层.png-hexo.png" alt="运输层-运输层和网络层"></p><p>网络层为主机之间提供逻辑通信（网络核心部分），运输层为应用进程之间提供端到端的逻辑通信（网络边缘部分）。<br>从运输层来看，通信是两主机应用进程之间相互通信。不同进程可以使用同一运输层协议传输数据。</p><p>运输层要对收到的报文进行差错检测。<br>在网络层，IP数据报首部的检验和字段，只检验首部而不检查数据部分。</p><p><strong>传输层</strong>的两个主要协议</p><p>(1) 用户数据报协议 UDP （User Datagram Protocol）<br>(2) 传输控制协议 TCP （Transmission Control Protocol）</p><p>在 OSI 中，两个对等实体在通信时传达的数据单元叫做传输协议数据单元 TPDU 。<br>在 TCP/IP 中，根据协议不同分别称之为TCP报文段、UDP数据段 。</p><p>UDP 传输数据之前不需要先建立连接，不提供可靠交付。<br>TCP 提供面向连接的服务，传输之前先建立连接，结束后要释放连接。不提供广播或者多播服务。</p><p><strong>运输层</strong>的端口</p><p>为了使运行在不同操作系统的计算机应用程序能够相互通信，使用统一的方法（在运输层使用协议端口号）对 TCP/IP 体系的应用进程进行标志。</p><p>在运输层使用协议端口使软端口，软件端口使应用层的各协议进程与传输实体进行层间交互的一种地址。<br>硬件端口使不同硬件设备进行交互的接口。</p><h1 id="用户数据报协议-UDP"><a href="#用户数据报协议-UDP" class="headerlink" title="用户数据报协议 UDP"></a>用户数据报协议 UDP</h1><p>UDP 只在 IP 的数据报服务之上增加了很少一点的功能，即端口的功能和差错检测的功能。</p><p>UDP 的主要特点：</p><ul><li>UDP 是无连接的，即发送数据之前不需要建立连接。</li><li>UDP 使用尽最大努力交付，即不保证可靠交付。</li><li>UDP 是面向报文的，对应用层交下来的报文、IP层交上来的UDP数据报，不合并也不拆分。</li><li>UDP 没有拥塞控制，很适合多媒体通信的要求。</li><li>UDP 支持一对一、一对多、多对一和多对多的交互通信。</li><li>UDP 的首部开销小，只有 8 个字节。</li></ul><p>UDP 的首部格式：</p><p><img src="https://img.wshunli.com/计算机基础-计算机网络/5/运输层-UDP报文段.png-hexo.png" alt="运输层-UDP报文段"></p><ul><li>源端口字段：源端口是一个大于1023的16位数字，由基于UDP应用程序的用户进程随机选择。</li><li>目的端口字段：目的端口号，在终点交付报文使用。</li><li>长度字段：指明了包括首部在内的UDP报文段长度。UDP长字段的值是UDP报文头的长度(8字节)与UDP所携带数据长度的总和。</li><li>校验和字段：指整个UDP报文头和UDP所带的数据的校验和（也包括伪报文头）。</li></ul><p>伪首部不包括在真正的UDP报文头中，但是它可以保证UDP数据被正确的主机收到了。因在校验和中加入了伪头标，故ICMP除能防止单纯数据差错之外，对IP分组也具有保护作用。</p><h1 id="传输控制协议-TCP"><a href="#传输控制协议-TCP" class="headerlink" title="传输控制协议 TCP"></a>传输控制协议 TCP</h1><p><strong>TCP</strong> 的主要特点：</p><ul><li>TCP 是面向连接的运输层协议。使用之前先建立建立连接，使用后释放。</li><li>每一条 TCP 连接只能有两个端点(endpoint)，每一条 TCP 连接只能是点对点的（一对一）。</li><li>TCP 提供可靠交付的服务，使用 TCP 连接传达的数据，无差错、不丢失、不重复，并且按序到达。</li><li>TCP 提供全双工通信。TCP 连接的两端都设有缓存，允许通信双方的应用进程在任何时候都能发送数据。</li><li>面向字节流。TCP 把应用程序交下来的数据仅仅看成一串无结构的字节流。不保证接收方和发送方的数据块具有对应的大小关系，但是字节流完全一样，由接收方应用程序还原成有意义的应用层数据。</li></ul><p><img src="https://img.wshunli.com/计算机基础-计算机网络/5/运输层-TCP面向字节流.png-hexo.png" alt="运输层-TCP面向字节流"></p><ul><li>TCP 连接是一条虚连接（逻辑连接）而不是一条真正的物理连接。</li><li>TCP 对应用进程一次把多长的报文发送到 TCP 的缓存中是不关心的。</li><li>TCP 根据对方给出的窗口值和当前网络拥塞的程度来决定一个报文段应包含多少个字节（UDP 发送的报文长度是应用进程给出的）。</li><li>TCP 可把太长的数据块划分短一些再传送。TCP 也可等待积累有足够多的字节后再构成报文段发送出去。</li></ul><p><strong>TCP</strong> 的连接</p><p>TCP 把<strong>连接</strong>作为最基本的抽象。<br>一条 TCP 连接有两个端点，又叫嵌套字（socket）或插口，由端口号拼接IP地址组成。</p><p>嵌套字 socket = IP地址 ： 端口号</p><p>每条 TCP 连接唯一地被通信两端的两个端点所确定。即：</p><p>TCP 连接 = {socket1，socket2} = {（IP1：port1），（IP2：port2）}</p><p>TCP 连接的端点是个很抽象的嵌套字。同一 IP 地址可以有多个 TCP 连接，同一端口号也可以出现在不同的 TCP 连接中。</p><p>TCP 与 UDP 的<strong>区别</strong>：</p><ul><li>TCP 提供面向连接的服务。</li><li>TCP 不提供广播或多播服务。</li><li>TCP 协议数据单元的首部增大很多，还要占用许多的处理机资源。</li><li>UDP 在传送数据之前不需要先建立连接。</li><li>对方收到 UDP 报文后，不需要给出任何确认。</li><li>在某些情况下 UDP 是一种最有效的工作方式。</li></ul><h1 id="可靠传输的工作原理"><a href="#可靠传输的工作原理" class="headerlink" title="可靠传输的工作原理"></a>可靠传输的工作原理</h1><p>TCP 发送的报文段是交给 IP 层传递的，但是 IP 层只能提供尽最大努力服务。也就是说，TCP下面的网络所提供的是不可靠的传输。</p><p>理想状态下的传输条件有两个特点：</p><ul><li>传输信道不产生差错。</li><li>不管发送方以多快的速度发送数据，接收方总是来得及处理收到的数据。</li></ul><h2 id="停止等地协议-ARQ"><a href="#停止等地协议-ARQ" class="headerlink" title="停止等地协议 ARQ"></a>停止等地协议 ARQ</h2><p>ARQ 协议（自动重传请求）是 OSI 模型中数据链路层和传输层的错误纠正协议之一。它通过使用 <strong>确认和超时</strong> 这两个机制，在不可靠服务的基础上实现可靠的信息传输。</p><p>1、无差错情况<br>“停止等待” 即每发送完一个分组就停止发送，等待对方确认。在收到确认后再发送下一个分组。</p><p><img src="https://img.wshunli.com/计算机基础-计算机网络/5/运输层-停止等待协议.png-hexo.png" alt="运输层-停止等待协议"></p><p>2、出错情况<br>B 接收分组使检测出差错就丢弃，其他什么也不做（不通知A收到有差错的分组），也可能发送过程中丢失了。<br>A 超过一段时间没有收到确认就认为分组丢失了，因而重传前面发送过的分组。</p><p>3、确认丢失和确认迟到<br>B 发送的确认丢失，A 又重传分组，此时B放弃重复的分组并再次向 A 发送确认。</p><p><img src="https://img.wshunli.com/计算机基础-计算机网络/5/运输层-停止等待协议-确认迟到和重复.png-hexo.png" alt="运输层-停止等待协议-确认迟到和重复"></p><p>A 收到重复的确认分组就放弃。</p><p>为了提高传输效率，发送方可以连续发送多个分组，不必每发完一个分组就停下来等待确认，即流水线传输。</p><p>流水线传输使用 连续ARQ协议和滑动窗口协议。</p><h2 id="连续-ARQ-协议"><a href="#连续-ARQ-协议" class="headerlink" title="连续 ARQ 协议"></a>连续 ARQ 协议</h2><p>接收方采用累计确认的方式。即接收方不必对收到的分组逐个发送确认，而是在收到几个分组后，对按需到达的最后一个分组确认，这就表示：到这分组为止的所有分组都已正确收到了。</p><h1 id="TCP-报文段"><a href="#TCP-报文段" class="headerlink" title="TCP 报文段"></a>TCP 报文段</h1><p>TCP（Transmission Control Protocol）传输控制协议是一种面向连接的、可靠的、基于字节流的传输层协议</p><p><img src="https://img.wshunli.com/计算机基础-计算机网络/5/运输层-TCP报文段.png-hexo.png" alt="运输层-TCP报文段"></p><ul><li>源端口和目标端口：和 UDP 类似，源端口号和目的端口号实现分用功能；</li><li>序号：本报文段所发送的数据项目组第一个字节的序号。在TCP传送的数据流中，每一个字节都有一个序号。例如，一报文段的序号为300，而起数据共100字节，则下一个报文段的序号就是400。</li><li>确认号：是期望收到对方下次发送的数据的第一个字节的序号，也就是期望收到的下一个报文段的首部中的序号。例如，B收到报文段序号字段是501，数据长度为200（字节的序号501-700），则表明B收到了A发送的到700为止的数据。因此B期望的数据序号是701，在确认报文段中确认号置为701。</li><li>数据偏移：数据起始处离TCP报文段的起始处有多远。实际上是TCP报文段首部的长度，因为首部长度不固定，所以数据偏移字段是必要的。数据偏移的单位是4个字节，即首部最大长度为 4*15。</li><li>保留字段： 供今后使用，目前置为0。</li></ul><p>控制位，用来说明本报文的性质：</p><ul><li>紧急URG（URGent）：当URG=1时，此报文应尽快传送，而不要按本来的列队次序来传送。与 “紧急指针” 字段共同应用，紧急指针指出在本报文段中的紧急数据的最后一个字节的序号，使接管方可以知道紧急数据共有多长；</li><li>确认ACK（ARKnowledge）：只有当ACK=1时，确认序号字段才有意义</li><li>推送PSH（PuSH）：当PSH=1时，希望接收方T尽快将本报文段传送给其应用层，而不要比及全部缓存都填满了之后再向上交付。</li><li>复位RST（ReSeT）：当RST=1时，表明TCP连接呈现严重错误，必须释放连接，然后再重建传输连接。复位比特还用来拒绝一个不法的报文段或拒绝打开一个连接；</li><li>同步比特SYN（SYNchronization）：在建立连接时用来同步序号。当SYN=1而ACK=0时，表明这是一个连接请求报文段。对方若接受建立连接，在响应的报文段中使SYN=1和ACK=1。所以，SYN=1默示这是一个连接请求或连接接受报文，而ACK的值用来区分是哪一种报文；</li><li>终止FIN（FINis）：用来释放一个连接，当FIN=1时，表示发送方的字节串已经发完，并请求释放传输连接；</li></ul><p>其他：</p><ul><li>窗口：指出现在允许对方发送的数据量，窗口值从本报文段的确认号算起，总是动态变化着。</li><li>检验和：检验和覆盖了整个的TCP报文段： TCP首部和TCP数据。这是一个强制性的字段，一定是由发端计算和存储，并由收端进行验证。</li><li>紧急指针：参考标志字段的URG位。</li><li>选项：为了适合复杂网络环境和更好地服务于应用层设计的。TCP选项最长是40字节。</li><li>数据：无任何数据的TCP段也是合法的，通常用于确认和控制信息。</li></ul><p>TCP 报文段的 <strong>选项</strong> 字段。</p><p>最大报文段长度 MSS ：TCP报文段中的 <strong>数据字段</strong> 的最大长度。<br>窗口扩大：就是为了建立TCP连接时协商扩大窗口。<br>时间戳：包含时间戳值和时间戳回送回答字段。计算往返时间、防止序号重复使用时序号绕回。<br>选择确认：见下节。</p><h1 id="TCP-可靠传输的实现"><a href="#TCP-可靠传输的实现" class="headerlink" title="TCP 可靠传输的实现"></a>TCP 可靠传输的实现</h1><p><strong>TCP 可靠传输</strong> 的实现：确认和重传、数据校验、数据合理分片和排序、流量控制、拥塞控制。</p><p>TCP 连接的每一端都必须设有两个窗口——一个发送窗口和一个接收窗口。<br>TCP 的可靠传输机制用字节的序号进行控制。TCP 所有的确认都是基于序号而不是基于报文段。</p><p><img src="https://img.wshunli.com/计算机基础-计算机网络/5/运输层-TCP可靠传输.png-hexo.png" alt="运输层-TCP可靠传输"></p><p>发送过的数据未收到确认之前必须保留，以便超时重传时使用。</p><p>发送窗口<strong>后沿</strong>变化有两种可能：发送窗口不动(没收到确认)和前移(收到新的确认)。<br><strong>前沿</strong>通常时不断向前移动，但也有可能不动（没有收到新的确认；收到确认但对方通知的窗口变小了）。</p><p><img src="https://img.wshunli.com/计算机基础-计算机网络/5/运输层-TCP缓存与窗口.png-hexo.png" alt="运输层-TCP缓存与窗口"></p><p>发送缓存用来暂时存放： 发送应用程序传送给发送方 TCP 准备发送的数据；TCP 已发送出但尚未收到确认的数据。<br>接收缓存用来暂时存放：按序到达的、但尚未被接收应用程序读取的数据； 不按序到达的数据。</p><p>必须强调三点：</p><ul><li>A 的发送窗口并不总是和 B 的接收窗口一样大（因为有一定的时间滞后）。</li><li>TCP 标准没有规定对不按序到达的数据应如何处理。通常是先临时存放在接收窗口中，等到字节流中所缺少的字节收到后，再按序交付上层的应用进程。</li><li>TCP 要求接收方必须有累积确认的功能，这样可以减小传输开销。</li></ul><h2 id="超时重传时间的选择"><a href="#超时重传时间的选择" class="headerlink" title="超时重传时间的选择"></a>超时重传时间的选择</h2><p>TCP 采用一种自适应算法。<br>TCP的发送方在规定的时间内没有收到确认就要重传已发送的报文段。但是由于TCP的下层互联网环境，发送的报文段可能只经过一个高速率的局域网，也可能经过多个低速率的网络，并且每个IP数据报所选择的路由还可能不同，因此注定超时重传时间要动态变化。</p><h2 id="选择确认-SACK"><a href="#选择确认-SACK" class="headerlink" title="选择确认 SACK"></a>选择确认 SACK</h2><p>选择确认是针对没有出错但是未按序到达的报文段，如果中间只是缺少一些报文段，那么发送方就可以不重传已发送的所有数据，而只是重传缺少的数据。</p><h1 id="TCP-的流量控制"><a href="#TCP-的流量控制" class="headerlink" title="TCP 的流量控制"></a>TCP 的流量控制</h1><p>流量控制就是让发送方的发送速率不要太快，让接收方来得及接受。利用滑动窗口机制就可以实施流量控制。<br>原理这就是运用TCP报文段中的窗口大小字段来控制，发送方的发送窗口不可以大于接收方发回的窗口大小。</p><p><img src="https://img.wshunli.com/计算机基础-计算机网络/5/运输层-TCP流量控制.png-hexo.png" alt="运输层-TCP流量控制"></p><p>考虑一种特殊的情况，就是接收方若没有缓存足够使用，就会发送零窗口大小的报文，此时发送放将发送窗口设置为0，停止发送数据。之后接收方有足够的缓存，发送了非零窗口大小的报文，但是这个报文在中途丢失的，那么发送方的发送窗口就一直为零导致死锁。<br>解决这个问题，TCP为每一个连接设置一个<strong>持续计时器</strong>（persistence timer）。只要TCP的一方收到对方的零窗口通知，就启动该计时器，周期性的发送一个零窗口<strong>探测报文段</strong>。对方就在确认这个报文的时候给出现在的窗口大小。</p><p>注意：TCP规定，即使设置为零窗口，也必须接收以下几种报文段：零窗口探测报文段、确认报文段和携带紧急数据的报文段。</p><h1 id="TCP-的拥塞控制"><a href="#TCP-的拥塞控制" class="headerlink" title="TCP 的拥塞控制"></a>TCP 的拥塞控制</h1><p>在某段时间，若对网络中的某一资源的需求超过了该资源所能提供的可用部分，网络的性能就要变化，这种情况叫做拥塞。</p><h2 id="拥塞控制设计"><a href="#拥塞控制设计" class="headerlink" title="拥塞控制设计"></a>拥塞控制设计</h2><p>拥塞控制是很难设计的，因为它是一个动态的问题，许多情况下，甚至正式拥塞控制机制本身成为引起网络性能恶化甚至死锁的原因。<br>从控制理论的角度来看拥塞控制这个问题，可以分为 <strong>开环控制和闭环控制</strong> 两种方法。</p><p><strong>开环控制</strong> 就是在设计网络时事先将有关拥塞发生的所有因素考虑周到，一旦系统运行起来就不能在中途改正。</p><p><strong>闭环控制</strong> 是基于反馈环路的概念，包括如下措施：</p><ol><li>监测网路系统以便检测拥塞在何时何地发生；</li><li>把拥塞发生的信息传送到可采取行动的地方；</li><li>调整网络系统的行动以解决出现的问题。</li></ol><h2 id="拥塞控制的方法"><a href="#拥塞控制的方法" class="headerlink" title="拥塞控制的方法"></a>拥塞控制的方法</h2><p>TCP 拥塞控制的算法有四种，即慢开始（Slow-start)，拥塞避免（Congestion Avoidance)，快重传（Fast Restrangsmit)和快恢复（Fast Recovery）。</p><p>我们假定：<br>1）数据是单方向传送，而另外一个方向只传送确认。<br>2）接收方总是有足够大的缓存空间，因为发送窗口的大小由网络的拥塞程度来决定。</p><p><strong>1.</strong> 慢开始和拥塞避免</p><p>发送方维持一个拥塞窗口(cwnd)的状态变量。其大小取决于网络的拥塞程度，并且动态的在变化。发送方让自己的发送窗口小于或等于拥塞窗口。</p><p>慢开始原理：</p><p>当主机开始发送数据时，如果立即将较大的发送窗口的全部数据字节都注入到网络中，那么由于不清楚网络的情况，有可能引其网络拥塞。比较好的方法是试探一下，即从小到达逐渐增大发送端的拥塞控制窗口数值。通常在刚刚开始发送报文段时可先将拥塞窗口cwnd(拥塞窗口)设置为一个最大报文段的MSS的数值。</p><p>在每收到一个对新报文段确认后，将拥塞窗口增加至多一个MSS的数值，当rwind（接收窗口）足够大的时候，为了防止拥塞窗口cwind的增长引起网络拥塞，还需要另外一个变量— <strong>慢开始门限</strong> ssthresh。</p><p><img src="https://img.wshunli.com/计算机基础-计算机网络/5/运输层-慢开始和拥塞避免.png-hexo.png" alt="运输层-慢开始和拥塞避免"></p><p>拥塞避免算法的思路是：让拥塞窗口cwnd线性缓慢增长。</p><p><strong>2.</strong> 快重传和快恢复</p><p>快重传的算法思路是：</p><ul><li>要求接收方每收到一个时序的报文段后就立即发出重复确认，而不是等待发送数据时才进行捎带确认</li><li>发送方只要一连收到三个重复确认，就应当立即重传对方尚未收到的报文段，而不必等待设置的重传计时器到期</li></ul><p>快恢复的算法思路是：</p><ul><li>当发送方连续收到三个重复确认时，就执行“乘法减小”算法，把慢开始阀值ssthresh减半</li><li>接着不执行慢开始，而是从新阀值ssthresh开始执行拥塞避免算法(加法增大)</li></ul><h2 id="TCP拥塞控制和流量控制的差别"><a href="#TCP拥塞控制和流量控制的差别" class="headerlink" title="TCP拥塞控制和流量控制的差别"></a>TCP拥塞控制和流量控制的差别</h2><p>拥塞控制就是防止过多的数据注入到网络中，这样可以使网络中的路由器或链路不致过载。拥塞控制所要做的都有一个前提，就是网络能承受现有的网络负荷。<br>拥塞控制是一个全局过程，涉及所有主机、所有路由器，以及降低网络传输性能有关的所有因素。</p><p>流量控制往往指的是点对点通信量的控制，是个端到端的问题。流量控制所要做的就是控制发送端发送数据的速率，以便使接收端来得及接受。</p><h1 id="TCP-的运输连接管理"><a href="#TCP-的运输连接管理" class="headerlink" title="TCP 的运输连接管理"></a>TCP 的运输连接管理</h1><p>TCP是面向连接的协议，运输连接是用来传送TCP报文段的。运输连接有三个阶段：<strong>连接建立、数据传送、连接释放</strong>。</p><p>在TCP连接建立过程中要解决三个问题：</p><ul><li>要使每一方知道对方的存在。</li><li>要允许双方协商一些参数（如最大窗口值、是否使用窗口扩大选项和时间戳选项以及服务质量等）。</li><li>能够对运输实体资源（如缓存大小、连接表中的项目等）进行分配。</li></ul><p>TCP连接的建立是采用客户服务器方式。主动发起连接建立的应用进程叫做客户（client），而被动等待连接建立的应用进程叫做服务器（sever）。</p><h2 id="TCP-的连接建立"><a href="#TCP-的连接建立" class="headerlink" title="TCP 的连接建立"></a>TCP 的连接建立</h2><p>假定主机A运行的是TCP客户程序，而B运行的是TCP服务器程序。最初两端的TCP都是处于CLOSED状态。A主动打开连接，B被动打开连接。</p><p><img src="https://img.wshunli.com/计算机基础-计算机网络/5/运输层-TCP连接建立.png-hexo.png" alt="运输层-TCP连接建立"></p><p>B的TCP服务器进程先创建传输控制块TCB，准备接受客户进程A的请求。然后服务器出于LISTEN状态，等待客户A的连接请求。</p><ul><li>A的客户端进程首先创建TCB，然后向B发送连接请求报文段。这时首部中的同不好SYN = 1，同时选择一个初始序号seq = x。TCP规定，SYN（SYN = 1）报文段不能携带数据，但是要消耗一个序号。这时客户机A进入同步已发送状态（SYN-SENT）。</li><li>B收到连接请求的报文段后，如果同意建立连接，则向A发送确认。在确认报文段中应当把SYN和ACK的值都置为1，确认号是ack = x + 1，同时也为自己初始化一个序号seq = y。注意该报文也不能携带数据，但是需要消耗掉一个序号。此时TCP服务器进程进入同步收到状态（SYN-RCVD）。</li><li>TCP客户进程收到服务器端的确认后，还要想B发送确认。报文段的ACK置为1，确认号ack = y + 1，而自己的序号为seq = x + 1。TCP的标准规定，ACK报文段可以携带数据，如果不携带数据则不消耗序号，在这种情况下，下一个报文段的序号仍是seq = x + 1.这时TCP连接已经建立，此时A已经进入ESTABLISHED状态。当B收到确认后，也进入ESTABLISHED状态。</li></ul><p>至此，A与B已经建立连接，我们称作“三报文握手”或者“三次握手”。</p><h2 id="TCP-的连接释放"><a href="#TCP-的连接释放" class="headerlink" title="TCP 的连接释放"></a>TCP 的连接释放</h2><p>当数据传输结束后，通信的上方都可以释放连接。现在A和B都处于ESTABLISHED状态。</p><p><img src="https://img.wshunli.com/计算机基础-计算机网络/5/运输层-TCP连接释放.png-hexo.png" alt="运输层-TCP连接释放"></p><ul><li>A的应用进程先向其TCP发出连接释放报文段，然后停止发送数据，主动关闭TCP连接。A的连接释放报文段把FIN置为1，其序号为seq = u，它等于前面已传送过的最后一个字节的序号加1。此时A进入FIN-WAIT-1状态，等待B的确认。TCP规定，FIN不携带数据，但是要消耗掉一个序号。</li><li>B收到连接释放报文段后向A发出确认，确认号是ack = u + 1,这个报文段自己的序号是v，等于B前面已传送数据的最后一个字节的序号加1。然后B进入CLOSE-WAIT状态。TCP服务器进程这时通知高层应用进程，因而从A到B这个方向的连接就释放了，这时TCP的连接处于半关闭状态，即A已经没有数据向B发送了，但是若B仍要发送数据，A依旧要接受。也就是说从B到A这个方向的连接并未关闭。</li><li>A收到来自B的报文段后进入FIN-WAIT-2状态，等待B的连续释放报文。</li><li>如果B已经没有数据向A发送了，其应用进程就会通知TCP释放连接。这时B发送连续确认报文段必须使FIN = 1，现在B的序号为w（在半关闭状态，B可能又发送了一段数据）B还必须重复已经发送过的确认号ack = u + 1。这时B进入了LAST-ACK状态，等待A的确认。</li><li>A在收到B的报文段后进行确认，其确认号为w + 1（TCP规定，FIN报文段需要消耗一个序号），其自己的序号为seq = u + 1。然后进入到TIME-WAIT状态。这时需要注意的是TCP连接还没有释放掉，必须经过时间等待计时器（TIME-WAIT timer）设置的2MSL（Maximum Segment Lifetime）,A才进入关闭状态。MSL叫做最大报文段寿命。</li></ul><p>上述的TCP的释放过程我们称为“四报文握手”或者“四次挥手”。</p><h2 id="TCP-的有限状态机"><a href="#TCP-的有限状态机" class="headerlink" title="TCP 的有限状态机"></a>TCP 的有限状态机</h2><p><img src="https://img.wshunli.com/计算机基础-计算机网络/5/运输层-TCP有限状态机.png-hexo.png" alt="运输层-TCP有限状态机"></p><p>可以非常清楚地看出 TCP 连接各种状态之间的关系。</p><ul><li>粗实线箭头表示客户机进程的正常变迁。</li><li>粗虚线箭头表示服务器进程的正常变迁。</li><li>细虚线表示异常变迁。</li></ul><blockquote style="margin:2em 0 0;padding:.5em 1em;border-left:3px solid #f44336;background-color:#f5f5f5;list-style:none"><p><strong>如果本文对您有所帮助，且您手头还很宽裕，欢迎打赏赞助我，以支付网站服务器和域名费用。 <img src="https://cdn.wshunli.com/about/pay_alpha.min.png" title="您的鼓励与支持，我会铭记于心，倾于博客。" alt="https://paypal.me/wshunli"> 您的鼓励与支持是我更新的最大动力，我会铭记于心，倾于博客。</strong><br><strong>本文链接：</strong><a href="https://www.wshunli.com/posts/c86dd6b.html">https://www.wshunli.com/posts/c86dd6b.html</a></p></blockquote></div><div id="comment" style="padding:10px" class="vcomment"></div><script src="https://cdn.wshunli.com/source/Valine.min.js"></script><script>var GUEST_INFO=["nick","mail","link"],guest_info="nick,mail,link".split(",").filter(function(i){return-1<GUEST_INFO.indexOf(i)}),notify=!1,verify=!1;new Valine({el:".vcomment",notify:notify,verify:verify,appId:"UiDq9ewdNKCHGJQyYrTFiohg-gzGzoHsz",appKey:"cuNKDo2T90xY7IjfGh21RMoQ",placeholder:"念念不忘，必有回响",pageSize:"10",avatar:"mp",lang:"zh-cn",guest_info:guest_info})</script></div><nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col"><a href="/posts/698896b2.html" id="post_nav-newer" class="prev-content"><button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation"><i class="material-icons">arrow_back</i></button> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 新篇</a><div class="section-spacer"></div><a href="/posts/6318182c.html" id="post_nav-older" class="next-content">旧篇 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation"><i class="material-icons">arrow_forward</i></button></a></nav></div></div><div class="sidebar-overlay"></div><aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation"><div id="sidebar-main"><div class="sidebar-header header-cover" style="background-image:url(https://cdn.wshunli.com/source/img/snow_square_tiny.png)"><div class="top-bar"></div><button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display:initial" data-upgraded=",MaterialButton,MaterialRipple"><i class="material-icons">clear_all</i> <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></button><div class="sidebar-image"><img src="/img/wshunli.min.png" alt="wshunli's avatar"></div><a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">admin@mail.wshunli.com <b class="caret"></b></a></div><ul class="nav sidebar-nav"><li class="dropdown"><ul id="settings-dropdown" class="dropdown-menu"><li><a href="mailto:admin@mail.wshunli.com" target="_blank" title="Email Me" rel="external nofollow noopener noreferrer"><i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i> Email Me</a></li></ul></li><li id="sidebar-first-li"><a href="/"><i class="material-icons sidebar-material-icons">home</i> 主页</a></li><li class="dropdown"><a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown"><i class="material-icons sidebar-material-icons">inbox</i> 归档 <b class="caret"></b></a><ul class="dropdown-menu"><li><a class="sidebar_archives-link" href="/archives/2019/06/">六月 2019<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/01/">一月 2019<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/12/">十二月 2018<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/11/">十一月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/10/">十月 2018<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/09/">九月 2018<span class="sidebar_archives-count">20</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/08/">八月 2018<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/07/">七月 2018<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/06/">六月 2018<span class="sidebar_archives-count">20</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/05/">五月 2018<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/04/">四月 2018<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/03/">三月 2018<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/01/">一月 2018<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/12/">十二月 2017<span class="sidebar_archives-count">12</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/11/">十一月 2017<span class="sidebar_archives-count">20</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">十月 2017<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">九月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/08/">八月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">七月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">五月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">三月 2017<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">二月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/05/">五月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/04/">四月 2016<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/03/">三月 2016<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/02/">二月 2016<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/01/">一月 2016<span class="sidebar_archives-count">13</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/12/">十二月 2015<span class="sidebar_archives-count">2</span></a></li></ul></li><li class="dropdown"><a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown"><i class="material-icons sidebar-material-icons">chrome_reader_mode</i> 分类 <b class="caret"></b></a><ul class="dropdown-menu"><li><a class="sidebar_archives-link" href="/categories/三维技术/">三维技术<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/前端技术/">前端技术<span class="sidebar_archives-count">18</span></a></li><li><a class="sidebar_archives-link" href="/categories/博客维护/">博客维护<span class="sidebar_archives-count">10</span></a></li><li><a class="sidebar_archives-link" href="/categories/后端技术/">后端技术<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/categories/持续集成/">持续集成<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/数据结构与算法/">数据结构与算法<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/沉迷学术/">沉迷学术<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/categories/源码解析/">源码解析<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/瞎推荐/">瞎推荐<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/categories/移动GIS技术/">移动GIS技术<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/categories/移动端技术/">移动端技术<span class="sidebar_archives-count">27</span></a></li><li><a class="sidebar_archives-link" href="/categories/计算机基础/">计算机基础<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/categories/设计模式/">设计模式<span class="sidebar_archives-count">15</span></a></li><li><a class="sidebar_archives-link" href="/categories/语言基础/">语言基础<span class="sidebar_archives-count">17</span></a></li><li><a class="sidebar_archives-link" href="/categories/跨平台技术/">跨平台技术<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/软件操作/">软件操作<span class="sidebar_archives-count">13</span></a></li></ul></li><li class="divider"></li><li><a href="/tags" title="标签云">标签云</a></li><li><a href="/timeline" title="时间轴">时间轴</a></li><li><a href="/books" title="我的阅读">我的阅读</a></li><li><a href="/zzupic" title="郑州大学">郑州大学</a></li><li><a href="/whupic" title="武汉大学">武汉大学</a></li><li><a href="/links" title="友情链接">友情链接</a></li><li><a href="/about" title="关于本站">关于本站</a></li><li class="divider"></li><li><a href="/archives">文章总数 <span class="sidebar-badge">168</span></a></li></ul></div></aside><div id="back-to-top" class="toTop-wrap"><a href="#top" class="toTop"><i class="material-icons footer_top-i">expand_less</i></a></div><footer class="mdl-mini-footer" id="bottom"><div class="mdl-mini-footer--left-section sns-list"><a href="https://twitter.com/wshunlime" target="_blank" rel="external nofollow noopener noreferrer"><button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter"><span class="visuallyhidden">Twitter</span></button></a><a href="https://facebook.com/wshunlime" target="_blank" rel="external nofollow noopener noreferrer"><button class="mdl-mini-footer--social-btn social-btn footer-sns-facebook"><span class="visuallyhidden">Facebook</span></button></a><a href="https://weibo.com/wshunli" target="_blank" rel="external nofollow noopener noreferrer"><button class="mdl-mini-footer--social-btn social-btn footer-sns-weibo"><span class="visuallyhidden">Weibo</span></button></a><a href="https://github.com/wshunli" target="_blank" rel="external nofollow noopener noreferrer"><button class="mdl-mini-footer--social-btn social-btn footer-sns-github"><span class="visuallyhidden">Github</span></button></a><a href="https://t.me/wshunli" target="_blank" rel="external nofollow noopener noreferrer"><button class="mdl-mini-footer--social-btn social-btn footer-sns-telegram"><span class="visuallyhidden">Telegram</span></button></a></div><div id="copyright">Copyright&nbsp;©&nbsp;<span year></span>&nbsp;CirGIS 博客<br><div>Hosted by <a class="footer-develop-a" href="https://coding.net/register?key=IBFMJ9" title="托管于 Coding Pages" rel="external nofollow noopener noreferrer" target="_blank">Coding Pages</a>. CDN by <a class="footer-develop-a" href="https://console.upyun.com/register/?invite=H1_D-bC4W" title="又拍云提供 CDN 服务" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdn.wshunli.com/source/img/upyun_logo.min.svg" style="width:44px;height:16px"> </a>.</div><div><a class="footer-develop-a" href="http://www.miitbeian.gov.cn/" rel="external nofollow noopener noreferrer" target="_blank">豫ICP备17022065号-1</a></div></div><div class="mdl-mini-footer--right-section"><div><div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a" rel="external nofollow noopener noreferrer">Hexo</a></div><div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a" rel="external nofollow noopener noreferrer">Material</a></div></div></div></footer><script>lsloader.load("lazyload_js","https://cdn.wshunli.com/source/js/lazyload.min.js",!0)</script><script>lsloader.load("js_js","https://cdn.wshunli.com/source/js/js.min.js",!0)</script><script>lsloader.load("np_js","https://cdn.wshunli.com/source/js/nprogress.js",!0)</script><script type="text/ls-javascript" id="NProgress-script">NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#909399'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #909399, 0 0 15px #909399'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#909399',
        'border-left-color': '#909399'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);</script><script>lsloader.load("sm_js","https://cdn.wshunli.com/source/js/smoothscroll.js",!0)</script><script>var agent=navigator.userAgent.toLowerCase();0<agent.indexOf("ucbrowser")&&(document.write('<link rel="stylesheet" href="/css/uc.css">'),alert("由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。"))</script><script>lsloader.load("prettify_js","https://cdn.wshunli.com/source/js/prettify.min.js",!0)</script><script type="text/ls-javascript" id="window-load">$(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                // 影响 hexo-tag-demo 代码高亮
                $('.demobox-code-wrap pre').removeClass('linenums');
                prettyPrint();
                })</script><script type="text/ls-javascript" id="lazy-load">// Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });</script><script>!function(e,t,n,a,c,i,o,d,s){d=function(){i=t.createElement(n),o=t.getElementsByTagName(n)[0],i.src="//widget.seniverse.com/widget/chameleon.js",i.charset="utf-8",i.async=1,o.parentNode.insertBefore(i,o)},e.ThinkPageWeatherWidgetObject=a,e[a]||(e[a]=function(){(e[a].q=e[a].q||[]).push(arguments)}),e[a].l=+new Date,e.attachEvent?e.attachEvent("onload",d):e.addEventListener("load",d,!1)}(window,document,"script","tpwidget")</script><script>function checkMobile(){return null==navigator.userAgent.match(/iPad/i)&&!(null==navigator.userAgent.match(/iphone|android|phone|mobile|wap|netfront|x11|java|opera mobi|opera mini|ucweb|windows ce|symbian|symbianos|series|webos|sony|blackberry|dopod|nokia|samsung|palmsource|xda|pieplus|meizu|midp|cldc|motorola|foma|docomo|up.browser|up.link|blazer|helio|hosin|huawei|novarra|coolpad|webos|techfaith|palmsource|alcatel|amoi|ktouch|nexian|ericsson|philips|sagem|wellcom|bunjalloo|maui|smartphone|iemobile|spice|bird|zte-|longcos|pantech|gionee|portalmmm|jig browser|hiptop|benq|haier|^lct|320x320|240x320|176x220/i))}checkMobile()||(tpwidget("init",{flavor:"bubble",location:"WW1CZDQBHSR6",geolocation:"enabled",position:"top-right",margin:"10px 10px",language:"zh-chs",unit:"c",theme:"chameleon",uid:"UBF84BD5E3",hash:"6e08d5d8c3aa65f452e1df6dd7785680"}),tpwidget("show"))</script><script>var copyrightNow=(new Date).getFullYear(),textContent=document.querySelector("span[year]");copyrightSince=2015,copyrightSince===copyrightNow||0===copyrightSince?textContent.textContent=copyrightNow:textContent.textContent=copyrightSince+" - "+copyrightNow,function(){for(var t=document.querySelectorAll('script[type="text/ls-javascript"]'),e=0;e<t.length;++e){var o=t[e];lsloader.runInlineScript(o.id,o.id)}}(),console.log("\n %c © Material Theme | Version: 1.5.5 | https://github.com/viosey/hexo-theme-material %c \n","color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;","color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;")</script></main></div><script src="https://cdn.wshunli.com/live2dw/lib/L2Dwidget.min.js"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"https://cdn.wshunli.com/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":90,"height":180,"hOffset":25,"vOffset":50},"mobile":{"show":false}});</script></body></html>